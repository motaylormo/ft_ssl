# PBKDF: turning the password into a key and IV
To start out, you need a password (string) and a salt (64 bits). If you are given a salt value by the user, use that. If not, generate a random one.

* **password:** `"towel"`
* **salt:** `4242424242424242`

Concatenate password and salt together:

| ascii             | hexadecimal |
| ----------------- | ----------- |
| `"towelBBBBBBBB"` |  `74 6f 77 65 6c 42 42 42 42 42 42 42 42`

MD5 hash that:
```MD5 ("towelBBBBBBBB") = daf91e7c5a178dfe90650f38c6e46f2b```

Split that in half. The left half becomes the key, the right half becomes the IV:
* **key:** `daf91e7c5a178dfe`
* **IV:** `90650f38c6e46f2b`

# Key Schedule: turing 1 key into 16 subkeys
We start with our 64-bit key:

| hexadecimal        | binary |
| ------------------ | ------ |
| `daf91e7c5a178dfe` | `1101101011111001000111100111110001011010000101111000110111111110`

Run that through permuted choice 1, turing the key from 64-bits to 56-bits:

| hexadecimal       | binary |
| ----------------- | ------ |
| `0c39b8abb5ecdff` | `11000011100110111000101010111011010111101100110111111111`

Split that into 2 halves of 28-bits:

|       | hexadecimal | binary |
| ----: | ----------- | ------ |
| left  | `c39b8ab`   | `1100001110011011100010101011`
| right | `b5ecdff`   | `1011010111101100110111111111`

Now the 16 rounds. Within each round,
1. the halves' bits are each rotated left by the number specified in the rotation table
2. concatenated together again (56-bits)
3. run through permuted choice 2 (56-bits to 48-bits)

| round | left | right | concatenated | PC-2 |
| ----: | ---- | ----- | ------------ | ---- |
| 0 | `1000011100110111000101010111`<br>(`8737157`) | `0110101111011001101111111111`<br>(`6bd9bff`) | `00000000000000000000000001110110101111011001101111111111`<br>(`087371576bd9bff`) | `000000000000000011111100111111111111110101001100`<br>(`b9c2fcfffd4c`)
| 1 | `0000111001101110001010101111`<br>(`0e6e2af`) | `1101011110110011011111111110`<br>(`d7b37fe`) | `00000000000000000000000011111101011110110011011111111110`<br>(`00e6e2afd7b37fe`) | `000000000000000010011010010111111001111011101111`<br>(`a5fc9a5f9eef`)
| 2 | `0011100110111000101010111100`<br>(`39b8abc`) | `0101111011001101111111111011`<br>(`5ecdffb`) | `00000000000000000000000011000101111011001101111111111011`<br>(`039b8abc5ecdffb`) | `000000000000000011000010110111101111110111111001`<br>(`762fc2defdf9`)
| 3 | `1110011011100010101011110000`<br>(`e6e2af0`) | `0111101100110111111111101101`<br>(`7b37fed`) | `00000000000000000000000000000111101100110111111111101101`<br>(`0e6e2af07b37fed`) | `000000000000000000010001001010111111111101111101`<br>(`7afc112bff7d`)
| 4 | `1001101110001010101111000011`<br>(`9b8abc3`) | `1110110011011111111110110101`<br>(`ecdffb5`) | `00000000000000000000000000111110110011011111111110110101`<br>(`09b8abc3ecdffb5`) | `000000000000000001011110111110111111110110110010`<br>(`4da55efbfdb2`)
| 5 | `0110111000101010111100001110`<br>(`6e2af0e`) | `1011001101111111111011010111`<br>(`b37fed7`) | `00000000000000000000000011101011001101111111111011010111`<br>(`06e2af0eb37fed7`) | `000000000000000010011111111011010100111100111111`<br>(`66c49fed4f3f`)
| 6 | `1011100010101011110000111001`<br>(`b8abc39`) | `1100110111111111101101011110`<br>(`cdffb5e`) | `00000000000000000000000010011100110111111111101101011110`<br>(`0b8abc39cdffb5e`) | `000000000000000000100010110111110111101011011110`<br>(`7f8922df7ade`)
| 7 | `1110001010101111000011100110`<br>(`e2af0e6`) | `0011011111111110110101111011`<br>(`37fed7b`) | `00000000000000000000000001100011011111111110110101111011`<br>(`0e2af0e637fed7b`) | `000000000000000010111011111101011101001111111101`<br>(`aaa8bbf5d3fd`)
| 8 | `1100010101011110000111001101`<br>(`c55e1cd`) | `0110111111111101101011110110`<br>(`6ffdaf6`) | `00000000000000000000000011010110111111111101101011110110`<br>(`0c55e1cd6ffdaf6`) | `000000000000000011000111111111111110111010011100`<br>(`89f2c7ffee9c`)
| 9 | `0001010101111000011100110111`<br>(`1578737`) | `1011111111110110101111011001`<br>(`bff6bd9`) | `00000000000000000000000001111011111111110110101111011001`<br>(`01578737bff6bd9`) | `000000000000000011001110011110010111011111011111`<br>(`315fce7977df`)
| 10 | `0101010111100001110011011100`<br>(`55e1cdc`) | `1111111111011010111101100110`<br>(`ffdaf66`) | `00000000000000000000000011001111111111011010111101100110`<br>(`055e1cdcffdaf66`) | `000000000000000011100001101111111111000010101111`<br>(`7071e1bff0af`)
| 11 | `0101011110000111001101110001`<br>(`5787371`) | `1111111101101011110110011011`<br>(`ff6bd9b`) | `00000000000000000000000000011111111101101011110110011011`<br>(`05787371ff6bd9b`) | `000000000000000001110101111001100111111111100111`<br>(`91cd75e67fe7`)
| 12 | `0101111000011100110111000101`<br>(`5e1cdc5`) | `1111110110101111011001101111`<br>(`fdaf66f`) | `00000000000000000000000001011111110110101111011001101111`<br>(`05e1cdc5fdaf66f`) | `000000000000000010010111101111101010101111111111`<br>(`c56397beabff`)
| 13 | `0111100001110011011100010101`<br>(`7873715`) | `1111011010111101100110111111`<br>(`f6bd9bf`) | `00000000000000000000000001011111011010111101100110111111`<br>(`07873715f6bd9bf`) | `000000000000000010100101111101111101111111010011`<br>(`3797a5f7dfd3`)
| 14 | `1110000111001101110001010101`<br>(`e1cdc55`) | `1101101011110110011011111111`<br>(`daf66ff`) | `00000000000000000000000001011101101011110110011011111111`<br>(`0e1cdc55daf66ff`) | `000000000000000011100011010111111010011101111011`<br>(`db10e35fa77b`)
| 15 | `1100001110011011100010101011`<br>(`c39b8ab`) | `1011010111101100110111111111`<br>(`b5ecdff`) | `00000000000000000000000010111011010111101100110111111111`<br>(`0c39b8abb5ecdff`) | `000000000000000001111011111101001101011111111111`<br>(`49aa7bf4d7ff`)

The PC-2 values are your subkeys for encryption mode:
```
subkey[ 0] = b9c2fcfffd4c
subkey[ 1] = a5fc9a5f9eef
subkey[ 2] = 762fc2defdf9
subkey[ 3] = 7afc112bff7d
subkey[ 4] = 4da55efbfdb2
subkey[ 5] = 66c49fed4f3f
subkey[ 6] = 7f8922df7ade
subkey[ 7] = aaa8bbf5d3fd
subkey[ 8] = 89f2c7ffee9c
subkey[ 9] = 315fce7977df
subkey[10] = 7071e1bff0af
subkey[11] = 91cd75e67fe7
subkey[12] = c56397beabff
subkey[13] = 3797a5f7dfd3
subkey[14] = db10e35fa77b
subkey[15] = 49aa7bf4d7ff
```

For decryption mode, you just invert the subkeys' order:
```
subkey[ 0] = 49aa7bf4d7ff
subkey[ 1] = db10e35fa77b
subkey[ 2] = 3797a5f7dfd3
subkey[ 3] = c56397beabff
subkey[ 4] = 91cd75e67fe7
subkey[ 5] = 7071e1bff0af
subkey[ 6] = 315fce7977df
subkey[ 7] = 89f2c7ffee9c
subkey[ 8] = aaa8bbf5d3fd
subkey[ 9] = 7f8922df7ade
subkey[10] = 66c49fed4f3f
subkey[11] = 4da55efbfdb2
subkey[12] = 7afc112bff7d
subkey[13] = 762fc2defdf9
subkey[14] = a5fc9a5f9eef
subkey[15] = b9c2fcfffd4c
```
